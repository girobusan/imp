<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IMP! Data embedding</title>
  <meta name="description" content="IMP! allows you to embed data into HTML, and use it in generation of static content and in Java Script and IMP! Helpers.">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <meta name="og:title" content="IMP! Data embedding">
  <meta name="og:description" content="IMP! allows you to embed data into HTML, and use it in generation of static content and in Java Script and IMP! Helpers.">
  <meta name="og:image" content="">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="">
  <link rel="icon" type="image/png" href="">
  <script>
   window.settings = {
  "title": "IMP! Data embedding",
  "description": "IMP! allows you to embed data into HTML, and use it in generation of static content and in Java Script and IMP! Helpers.",
  "image": "",
  "icon": "",
  "filename": "data-embedding.html",
  "footer": "&lt;small&gt;Powered by &lt;a href='https://github.com/girobusan/imp'&gt;IMP!&lt;/a&gt; and &lt;a href='https://matejlatin.github.io/Gutenberg/'&gt;Gutenberg CSS&lt;/a&gt;&lt;/small&gt;",
  "css": "ul ul{\nmargin-bottom: 0\n}\n.linkToTop{\ntext-decoration: none;\ncolor: royalblue !important;\n}",
  "headHTML": "",
  "editor": "",
  "viewCSS": "",
  "author": "",
  "keywords": "",
  "enableHelpers": "true",
  "disableInteractivity": "",
  "pathToHelpersModule": ""
}
   window.savedWithImpVersion = "0.4.4"
  </script>
  <script>
   function IMPEdit(){
   console.info("Loading editor...")
   const editor = document.createElement("script");
   editor.id="editorScript";
   editor.src="imp.js";
   document.head.appendChild(editor);
   }
   window.addEventListener("DOMContentLoaded" , function(){
  
   if(window.location.search.indexOf("mode=view")!=-1)
   {
   return;
   }
   if(window.location.search.indexOf("mode=edit")!=-1)
   {
   IMPEdit();
   return;
   }
   if(window.location.search.indexOf("mode=download")!=-1){
   IMPEdit();
   return;
   }
   if(window.location.protocol==="file:"){
   IMPEdit();
   }
  
})
  </script>
  <script src='helpers.js' id='helpersScript'></script>
  <link id = "viewCSS" rel="stylesheet" href="style.css">
  <style id="customCSS">ul ul{
margin-bottom: 0
}
.linkToTop{
text-decoration: none;
color: royalblue !important;
}</style>
  <!--custom html here-->
</head>
<body>
<main class='container' id='pageMain'><p><a href="/">Girobusan</a> Â· <a href="index.html">IMP!</a></p>
<h1>IMP! Data Embedding</h1>
<p><span data-ihelper='headers-nav' data-params="%0AskipH1:%20true%0AlinkBack:%20%22%3Csup%3E&uarr;%3C/sup%3E%22%0A"></span></p>
<hr>
<h2>Intro</h2>
<p>IMP! (since version 0.5) allows you to embed data into HTML. Data can than be used by <a href="helpers.html">helpers</a>, in static and/or interactive content, or by your own scripts.</p>
<h2>Attaching data</h2>
<p>You can add data in IMP! GUI. There are two types of embedded data: <code>string</code> and <code>object</code>. String is just unstructured string, you need to parse it in your code. Object is a structured data, which can be operated directly.</p>
<p><img src="data-ui.png" alt="Empty data UI"> <small>GUI for data, when no data is embedded</small></p>
<p>There are two buttons in the GUI. <code>Embed JSON</code> is for embedding well-formed JSON files. The data will be parsed and used as <code>object</code>. <code>Embed text</code> embeds unstructured text as is.</p>
<p><img src="data-ui-full.png" alt="Data UI with some data entered"> <small>Data embedded</small></p>
<p>Frim GUI you can rename, replace, download or delete any data unit.</p>
<h2>Retrieving data</h2>
<p>Data, added in GUI is always available. It can be used in helpers to render static HTML, as well as in interactive content. There are more than one way to retrieve it.</p>
<h3>Directly</h3>
<p>Embedded data is saved in global variable <code>window.impData</code>, which has the following structure:</p>
<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">impData</span>{
	.
	.
	<span class="hljs-string">&quot;data-id&quot;</span>: {
		<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span> or <span class="hljs-string">&quot;object&quot;</span>,
		<span class="hljs-string">&quot;data&quot;</span>: -- data itself, 
		           object or string
	}
	.
	.
}
</code></pre>
<p>HTML tags are escaped. The variable will be available after <code>DOMContentLoaded</code> event.</p>
<h3>Via fetch()</h3>
<p>In IMP! GUI and in view mode, <em>if helpers are enabled,</em> standard fetch() function is patched to allow access to embedded data. Just pass data id  with prepended &quot;@&quot; as url.</p>
<p>For example, you can embed csv file as text, named <code>stocks.csv</code>, and then feed it to vega-lite via &quot;special url&quot;, like this:</p>
<pre><code class="language-json"> ```helper<span class="hljs-punctuation">:</span>vega-embed
 <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Stock prices of 5 ...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@stocks.csv&quot;</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> 
  <span class="hljs-comment">//the rest of the code...</span>
 ```
</code></pre>
<p>You may use in your own scripts. Remember to enable helpers, you do not need to use any helpers, just load the module.</p>
<h2>Writting data</h2>
<p>Helpers can write data, for example, in <code>render()</code> function, but this data may not be available to other helpers <code>render()</code>. You can write data in <code>render()</code> in order to read it later in <code>animate()</code> function.</p>
<p>Of course, you can write data in <code>animate</code> but if you write data in <code>animate()</code> it won't be saved.</p>
<p>Please, <strong>do not use data embedding for saving helper parameters</strong>. Embedded data is global and has no namespaces, and helpers have no methods to clean up after deleting.</p>
</main>
<footer id="pageFooter"><small>Powered by <a href='https://github.com/girobusan/imp'>IMP!</a> and <a href='https://matejlatin.github.io/Gutenberg/'>Gutenberg CSS</a></small></footer>
<script id="pageData" type="text/markdown">[Girobusan](/) &amp;middot; [IMP!](index.html)

# IMP! Data Embedding

```h:headers-nav
skipH1: true
linkBack: "&lt;sup&gt;&amp;uarr;&lt;/sup&gt;"
```

----


## Intro

IMP! (since version 0.5) allows you to embed data into HTML. Data can than be used by [helpers](helpers.html), in static and/or interactive content, or by your own scripts. 

## Attaching data

You can add data in IMP! GUI. There are two types of embedded data: `string` and `object`. String is just unstructured string, you need to parse it in your code. Object is a structured data, which can be operated directly.

![Empty data UI](data-ui.png) --GUI for data, when no data is embedded--

There are two buttons in the GUI. `Embed JSON` is for embedding well-formed JSON files. The data will be parsed and used as `object`. `Embed text` embeds unstructured text as is.

![Data UI with some data entered](data-ui-full.png) --Data embedded--

Frim GUI you can rename, replace, download or delete any data unit.

## Retrieving data
Data, added in GUI is always available. It can be used in helpers to render static HTML, as well as in interactive content. There are more than one way to retrieve it.

### Directly

Embedded data is saved in global variable `window.impData`, which has the following structure:

```javascript
window.impData{
	.
	.
	"data-id": {
		"type": "string" or "object",
		"data": -- data itself, 
		           object or string
	}
	.
	.
}
```

HTML tags are escaped. The variable will be available after `DOMContentLoaded` event. 

### Via fetch()
In IMP! GUI and in view mode, _if helpers are enabled,_ standard fetch() function is patched to allow access to embedded data. Just pass data id  with prepended "@" as url.

For example, you can embed csv file as text, named `stocks.csv`, and then feed it to vega-lite via "special url", like this:

~~~json
 ```helper:vega-embed
 {
  "description": "Stock prices of 5 ...",
  "data": {"url": "@stocks.csv"}, 
  //the rest of the code...
 ```
~~~ 

You may use in your own scripts. Remember to enable helpers, you do not need to use any helpers, just load the module.

## Writting data
Helpers can write data, for example, in `render()` function, but this data may not be available to other helpers `render()`. You can write data in `render()` in order to read it later in `animate()` function. 

Of course, you can write data in `animate` but if you write data in `animate()` it won't be saved.

Please, **do not use data embedding for saving helper parameters**. Embedded data is global and has no namespaces, and helpers have no methods to clean up after deleting.</script>
</body>
</html>